function AppDataModel(){var e=this;e.userInfoUrl="/api/Me",e.siteUrl="/",e.returnUrl=e.siteUrl,e.setAccessToken=function(e){sessionStorage.setItem("accessToken",e)},e.getAccessToken=function(){return sessionStorage.getItem("accessToken")}}
function AppViewModel(e){var n=this;n.Views={Loading:{}},n.dataModel=e,n.view=ko.observable(n.Views.Loading),n.loading=ko.computed(function(){return n.view()===n.Views.Loading}),n.addViewModel=function(o){var i,a=new o.factory(n,e);n.Views[o.name]=a,n[o.bindingMemberName]=ko.computed(function(){if(!e.getAccessToken()){var i=common.getFragment();i.access_token?(window.location.hash=i.state||"",e.setAccessToken(i.access_token)):window.location="/Account/Authorize?client_id=web&response_type=token&state="+encodeURIComponent(window.location.hash)}return n.Views[o.name]}),i="undefined"!=typeof o.navigatorFactory?o.navigatorFactory(n,e):function(){window.location.hash=o.bindingMemberName},n["navigateTo"+o.name]=i},n.initialize=function(){Sammy().run()}}var app=new AppViewModel(new AppDataModel);
window.common=function(){function n(n){var o,t,r,e,i,u,d,s={};if(null===n)return s;o=n.split("&");for(var a=0;a<o.length;a++)t=o[a],r=t.indexOf("="),-1===r?(e=t,i=null):(e=t.substr(0,r),i=t.substr(r+1)),u=decodeURIComponent(e),d=decodeURIComponent(i),s[u]=d;return s}var o={};return o.getFragment=function(){return 0===window.location.hash.indexOf("#")?n(window.location.hash.substr(1)):{}},o}();
function HomeViewModel(e,o){var t=this;return t.myHometown=ko.observable(""),Sammy(function(){this.get("#home",function(){$.ajax({method:"get",url:e.dataModel.userInfoUrl,contentType:"application/json; charset=utf-8",headers:{Authorization:"Bearer "+e.dataModel.getAccessToken()},success:function(e){t.myHometown("Your Hometown is : "+e.hometown)}})}),this.get("/",function(){this.app.runRoute("get","#home")})}),t}app.addViewModel({name:"Home",bindingMemberName:"home",factory:HomeViewModel});
$(function(){app.initialize(),ko.validation.init({grouping:{observable:!1}}),ko.applyBindings(app)});